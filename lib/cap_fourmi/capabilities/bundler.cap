namespace :bundler do
  desc "Ensure Bundler is present"
  task :check_install do
    on roles(:app) do
      installed = (capture(:env, 'gem', 'query', '--local') =~ /bundler/)
      unless installed
        error "Bundler not installed, install it first (bundler:install)"
        exit
      end
    end
  end

  desc "Install Bundler"
  task :install do
    on roles(:all) do
      execute :env, 'gem', 'install', 'bundler'
    end
  end
end
